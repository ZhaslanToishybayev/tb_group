# üÜò TROUBLESHOOTING - –†–ï–®–ï–ù–ò–ï –ü–†–û–ë–õ–ï–ú

## üö® –¢–û–ü-10 –ü–†–û–ë–õ–ï–ú –ò –†–ï–®–ï–ù–ò–ô

### 1Ô∏è‚É£ Backend –Ω–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è (Railway)

**–°–∏–º–ø—Ç–æ–º—ã:**
- –°—Ç–∞—Ç—É—Å: "Failed" –∏–ª–∏ "Crashed"
- –õ–æ–≥–∏ –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç –æ—à–∏–±–∫–∏

**–†–µ—à–µ–Ω–∏–µ:**
```bash
# 1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏: Railway ‚Üí Deploy ‚Üí View Logs
# 2. –ß–∞—Å—Ç—ã–µ –æ—à–∏–±–∫–∏:

# DATABASE_URL –Ω–µ–≤–µ—Ä–Ω—ã–π
‚ùå –û–®–ò–ë–ö–ê: "connection refused"
‚úÖ –†–ï–®–ï–ù–ò–ï: –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ PostgreSQL –¥–æ–±–∞–≤–ª–µ–Ω –∏ DATABASE_URL –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π

# JWT_SECRET —Å–ª–∏—à–∫–æ–º –∫–æ—Ä–æ—Ç–∫–∏–π
‚ùå –û–®–ò–ë–ö–ê: "Invalid environment configuration"
‚úÖ –†–ï–®–ï–ù–ò–ï: JWT_ACCESS_SECRET –∏ JWT_REFRESH_SECRET –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –º–∏–Ω–∏–º—É–º 16 —Å–∏–º–≤–æ–ª–æ–≤

# PORT –Ω–µ —á–∏—Å–ª–æ
‚ùå –û–®–ò–ë–ö–ê: "invalid port number"
‚úÖ –†–ï–®–ï–ù–ò–ï: PORT=4000 (—á–∏—Å–ª–æ, –Ω–µ —Å—Ç—Ä–æ–∫–∞)
```

**–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≤—Å–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ:**
```
NODE_ENV = production
PORT = 4000
DATABASE_URL = postgresql://... (–æ—Ç Railway)
JWT_ACCESS_SECRET = ... (32+ —Å–∏–º–≤–æ–ª–∞)
JWT_REFRESH_SECRET = ... (32+ —Å–∏–º–≤–æ–ª–∞)
```

---

### 2Ô∏è‚É£ Frontend –Ω–µ –≤–∏–¥–∏—Ç API (Vercel)

**–°–∏–º–ø—Ç–æ–º—ã:**
- –°–∞–π—Ç –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è
- –§–æ—Ä–º–∞ –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è
- –û—à–∏–±–∫–∏ –≤ –∫–æ–Ω—Å–æ–ª–∏ –±—Ä–∞—É–∑–µ—Ä–∞

**–†–µ—à–µ–Ω–∏–µ:**
```bash
# 1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –≤ Vercel:
# Settings ‚Üí Environment Variables

NEXT_PUBLIC_API_BASE_URL = https://–≤–∞—à-railway-app.railway.app
# ‚ö†Ô∏è –î–û–õ–ñ–ï–ù –∑–∞–∫–∞–Ω—á–∏–≤–∞—Ç—å—Å—è –ù–ï –Ω–∞ —Å–ª—ç—à!
# ‚ùå –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û: https://abc.railway.app/
# ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û: https://abc.railway.app

# 2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ API:
curl https://–≤–∞—à-railway-app.railway.app/api/health
# –î–æ–ª–∂–Ω–æ –≤–µ—Ä–Ω—É—Ç—å: {"status":"ok"}

# 3. –ü–µ—Ä–µ–∑–∞–¥–µ–ø–ª–æ–π—Ç–µ Vercel –ø–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö
```

---

### 3Ô∏è‚É£ CORS –æ—à–∏–±–∫–∏

**–°–∏–º–ø—Ç–æ–º—ã:**
```
Access to fetch at 'https://railway.app' from origin
'https://vercel.app' has been blocked by CORS policy
```

**–†–µ—à–µ–Ω–∏–µ:**
```bash
# –í Railway ‚Üí Variables:
# ALLOWED_ORIGINS –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å –í–°–ï –≤–∞—à–∏ –¥–æ–º–µ–Ω—ã

ALLOWED_ORIGINS = https://tb-group-xyz.vercel.app,https://tbgroup.kz

# ‚ö†Ô∏è –í–ê–ñ–ù–û:
# - –ë–ï–ó —Å–ª–µ—à–µ–π –≤ –∫–æ–Ω—Ü–µ
# - –¢–æ—á–Ω—ã–µ URL
# - –ß–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é –ë–ï–ó –ø—Ä–æ–±–µ–ª–æ–≤
```

---

### 4Ô∏è‚É£ reCAPTCHA –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

**–°–∏–º–ø—Ç–æ–º—ã:**
- reCAPTCHA –Ω–µ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è
- "reCAPTCHA verification failed"

**–†–µ—à–µ–Ω–∏–µ:**
```bash
# 1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–ª—é—á–∏:
# - –í Vercel: NEXT_PUBLIC_RECAPTCHA_SITE_KEY
# - –í Railway: RECAPTCHA_SECRET
# - –î–æ–ª–∂–Ω—ã –±—ã—Ç—å –†–ê–ó–ù–´–ï –∫–ª—é—á–∏!

# 2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–æ–º–µ–Ω—ã –≤ Google reCAPTCHA:
# https://www.google.com/recaptcha/admin
# –î–æ–º–µ–Ω—ã: localhost, –≤–∞—à-vercel-url.vercel.app

# 3. –î–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –º–æ–∂–Ω–æ –æ—Ç–∫–ª—é—á–∏—Ç—å:
# –í Railway: BITRIX24_USE_STUB = true
```

---

### 5Ô∏è‚É£ Bitrix24 –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

**–°–∏–º–ø—Ç–æ–º—ã:**
- –§–æ—Ä–º–∞ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è
- –ù–æ –ª–∏–¥—ã –Ω–µ –ø–æ—è–≤–ª—è—é—Ç—Å—è –≤ Bitrix24

**–†–µ—à–µ–Ω–∏–µ:**
```bash
# 1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ webhook URL:
BITRIX24_WEBHOOK_URL = https://–≤–∞—à-–¥–æ–º–µ–Ω.bitrix24.kz/rest/1/xxx/webhook/

# 2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏:
BITRIX24_USE_STUB = false
BITRIX24_ENABLE_LOGGING = true

# 3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏:
# Railway ‚Üí Deploy ‚Üí View Logs
# –ò—â–∏—Ç–µ –∑–∞–ø–∏—Å–∏ –æ Bitrix24

# 4. –î–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:
# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ BITRIX24_USE_STUB = true
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ - –±—É–¥–µ—Ç –≤–∏–¥–Ω–æ —á—Ç–æ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è
```

---

### 6Ô∏è‚É£ –°–∞–π—Ç –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç 404

**–°–∏–º–ø—Ç–æ–º—ã:**
- Vercel –¥–µ–ø–ª–æ–π —É—Å–ø–µ—à–Ω—ã–π
- –ù–æ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –Ω–µ –æ—Ç–∫—Ä—ã–≤–∞—é—Ç—Å—è

**–†–µ—à–µ–Ω–∏–µ:**
```bash
# 1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ Vercel:
# Root Directory: apps/web (–ù–ï apps/)
# Build Command: npm run build
# Output Directory: .next

# 2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏ –µ—Å—Ç—å:
# apps/web/package.json
# apps/web/next.config.mjs

# 3. –ü–µ—Ä–µ–∑–∞–¥–µ–ø–ª–æ–π—Ç–µ:
# Vercel ‚Üí Deployments ‚Üí Redeploy
```

---

### 7Ô∏è‚É£ –û—à–∏–±–∫–∞ —Å–±–æ—Ä–∫–∏ (Build Error)

**–°–∏–º–ø—Ç–æ–º—ã:**
```
Failed to build
Build failed
```

**–†–µ—à–µ–Ω–∏–µ:**
```bash
# 1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ TypeScript –æ—à–∏–±–∫–∏:
cd apps/web
npm run build

# 2. –ß–∞—Å—Ç—ã–µ –ø—Ä–æ–±–ª–µ–º—ã:
# - –û—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
# - –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –∏–º–ø–æ—Ä—Ç—ã
# - TypeScript –æ—à–∏–±–∫–∏

# 3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ next.config.mjs:
# –î–æ–ª–∂–µ–Ω —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –∫–æ–Ω—Ñ–∏–≥
```

---

### 8Ô∏è‚É£ –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –Ω–µ –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è

**–°–∏–º–ø—Ç–æ–º—ã:**
- –ò–∑–º–µ–Ω–∏–ª–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –≤ Vercel/Railway
- –ù–∏—á–µ–≥–æ –Ω–µ –∏–∑–º–µ–Ω–∏–ª–æ—Å—å

**–†–µ—à–µ–Ω–∏–µ:**
```bash
# 1. Railway: –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
# –ü—Ä–æ—Å—Ç–æ –ø–æ–¥–æ–∂–¥–∏—Ç–µ 1-2 –º–∏–Ω—É—Ç—ã

# 2. Vercel: –ù—É–∂–µ–Ω —Ä–µ–¥–µ–ø–ª–æ–π
# Deployments ‚Üí Redeploy Latest

# 3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã
# –í –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ Vercel/Railway
```

---

### 9Ô∏è‚É£ –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –Ω–µ –ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è

**–°–∏–º–ø—Ç–æ–º—ã:**
```
connection refused
invalid database url
```

**–†–µ—à–µ–Ω–∏–µ:**
```bash
# 1. –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ PostgreSQL –¥–æ–±–∞–≤–ª–µ–Ω –≤ Railway:
# Railway ‚Üí New ‚Üí Database ‚Üí PostgreSQL

# 2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ DATABASE_URL:
# –î–æ–ª–∂–µ–Ω –±—ã—Ç—å –≤ —Ñ–æ—Ä–º–∞—Ç–µ:
# postgresql://user:password@host:port/database

# 3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ –±–∞–∑–∞ —Å–æ–∑–¥–∞–Ω–∞:
# Railway ‚Üí Database ‚Üí Connect ‚Üí psql –∫–æ–º–∞–Ω–¥–∞
```

---

### üîü –§–æ—Ä–º–∞ –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è

**–°–∏–º–ø—Ç–æ–º—ã:**
- –ù–∞–∂–∏–º–∞–µ—Ç–µ "–û—Ç–ø—Ä–∞–≤–∏—Ç—å"
- –ù–∏—á–µ–≥–æ –Ω–µ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç
- –ò–ª–∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –æ—à–∏–±–∫—É

**–†–µ—à–µ–Ω–∏–µ:**
```bash
# 1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞ (F12)
# –ò—â–∏—Ç–µ JavaScript –æ—à–∏–±–∫–∏

# 2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ Network tab:
# POST –∑–∞–ø—Ä–æ—Å –∫ /api/contact
# –°—Ç–∞—Ç—É—Å 200? –û—à–∏–±–∫–∞?

# 3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ Railway –ª–æ–≥–∏:
# –ï—Å—Ç—å –ª–∏ –∑–∞–ø—Ä–æ—Å—ã –∫ API?

# 4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ:
# NEXT_PUBLIC_API_BASE_URL –≤ Vercel
# ALLOWED_ORIGINS –≤ Railway
```

---

## üîç –î–ò–ê–ì–ù–û–°–¢–ò–ö–ê

### –ü—Ä–æ–≤–µ—Ä–∏—Ç—å Backend (Railway):
```bash
# 1. Health check:
curl https://–≤–∞—à-railway-app.railway.app/api/health
# –û–∂–∏–¥–∞–µ–º: {"status":"ok"}

# 2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤—Å–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ:
curl https://–≤–∞—à-railway-app.railway.app/api/analytics/config
# –ü–æ–∫–∞–∂–µ—Ç –∫–æ–Ω—Ñ–∏–≥
```

### –ü—Ä–æ–≤–µ—Ä–∏—Ç—å Frontend (Vercel):
```bash
# 1. –û—Ç–∫—Ä—ã—Ç—å –≤ –±—Ä–∞—É–∑–µ—Ä–µ:
https://–≤–∞—à-vercel-url.vercel.app

# 2. –û—Ç–∫—Ä—ã—Ç—å DevTools (F12)
# Console: –Ω–µ—Ç –∫—Ä–∞—Å–Ω—ã—Ö –æ—à–∏–±–æ–∫?
# Network: –∑–∞–ø—Ä–æ—Å—ã –∫ API —É—Å–ø–µ—à–Ω—ã?
```

### –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é:
```bash
# 1. –û—Ç–ø—Ä–∞–≤–∏—Ç—å —Ñ–æ—Ä–º—É
# 2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å Railway –ª–æ–≥–∏
# 3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å Bitrix24 (–µ—Å–ª–∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω)
```

---

## üÜò –ü–û–õ–£–ß–ò–¢–¨ –ü–û–ú–û–©–¨

### –õ–æ–≥–∏:
```bash
# Railway: Project ‚Üí Deploy ‚Üí View Logs
# Vercel: Project ‚Üí Deployments ‚Üí View Function Logs
```

### Debug:
```bash
# 1. –í–∫–ª—é—á–∏—Ç–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ:
# Railway ‚Üí Variables:
BITRIX24_ENABLE_LOGGING = true
LOG_LEVEL = debug

# 2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ .env –ª–æ–∫–∞–ª—å–Ω–æ:
cd apps/api
cat .env
```

### –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫:
```bash
# Railway: –ù–∞–∂–∞—Ç—å "Restart" –≤ Deploy tab
# Vercel: Deployments ‚Üí Redeploy
```

---

## ‚úÖ –ü–†–û–í–ï–†–û–ß–ù–´–ô –°–ö–†–ò–ü–¢

```bash
#!/bin/bash
echo "=== –î–ò–ê–ì–ù–û–°–¢–ò–ö–ê ==="
echo ""

echo "1. –ü—Ä–æ–≤–µ—Ä–∫–∞ Backend:"
curl -s https://–≤–∞—à-railway-app.railway.app/api/health | jq .

echo ""
echo "2. –ü—Ä–æ–≤–µ—Ä–∫–∞ Frontend:"
curl -s -I https://–≤–∞—à-vercel-url.vercel.app | head -1

echo ""
echo "3. –ü—Ä–æ–≤–µ—Ä–∫–∞ CORS:"
curl -s -H "Origin: https://–≤–∞—à-vercel-url.vercel.app" \
     -H "Access-Control-Request-Method: POST" \
     -H "Access-Control-Request-Headers: Content-Type" \
     -X OPTIONS \
     https://–≤–∞—à-railway-app.railway.app/api/contact

echo ""
echo "=== –ì–û–¢–û–í–û ==="
```

---

## üìû –ö–û–ù–¢–ê–ö–¢–´

–ï—Å–ª–∏ –ø—Ä–æ–±–ª–µ–º–∞ –Ω–µ —Ä–µ—à–∞–µ—Ç—Å—è:
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≤—Å–µ –ø—É–Ω–∫—Ç—ã –≤—ã—à–µ
2. –°–æ–±–µ—Ä–∏—Ç–µ –ª–æ–≥–∏ (Railway + Vercel)
3. –û–ø–∏—à–∏—Ç–µ –ø—Ä–æ–±–ª–µ–º—É —Å –¥–µ—Ç–∞–ª—è–º–∏

**–£–¥–∞—á–∏! üöÄ**
