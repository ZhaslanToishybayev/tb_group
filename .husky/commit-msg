#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

# Color codes for output
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
NC='\033[0m' # No Color

echo -e "${YELLOW}üìù Validating commit message...${NC}\n"

# Get commit message from argument or file
COMMIT_MSG="$1"

# Conventional Commits pattern
# Format: <type>[optional scope]: <description>
# Optional body
# Optional footer(s)
PATTERN="^(feat|fix|docs|style|refactor|test|chore|perf|ci|build|revert)(\(.+\))?: .{1,50}"

if ! grep -qE "$PATTERN" "$COMMIT_MSG"; then
  echo -e "${RED}‚ùå Invalid commit message format!${NC}\n"
  echo -e "${YELLOW}Expected format:${NC}"
  echo -e "${GREEN}<type>[optional scope]: <description>${NC}\n"
  echo -e "${YELLOW}Examples:${NC}"
  echo -e "  ${GREEN}feat: add new user authentication module${NC}"
  echo -e "  ${GREEN}fix(api): resolve memory leak in data handler${NC}"
  echo -e "  ${GREEN}docs: update installation instructions${NC}"
  echo -e "  ${GREEN}test(status-service): add integration tests${NC}\n"
  echo -e "${YELLOW}Valid types:${NC}"
  echo -e "  ${GREEN}feat${NC}     - A new feature"
  echo -e "  ${GREEN}fix${NC}      - A bug fix"
  echo -e "  ${GREEN}docs${NC}     - Documentation only changes"
  echo -e "  ${GREEN}style${NC}    - Changes that do not affect the meaning of the code"
  echo -e "  ${GREEN}refactor${NC} - A code change that neither fixes a bug nor adds a feature"
  echo -e "  ${GREEN}perf${NC}     - A code change that improves performance"
  echo -e "  ${GREEN}test${NC}     - Adding missing tests or correcting existing tests"
  echo -e "  ${GREEN}chore${NC}    - Changes to the build process or auxiliary tools"
  echo -e "  ${GREEN}ci${NC}       - Changes to CI configuration files and scripts"
  echo -e "  ${GREEN}build${NC}    - Changes that affect the build system or dependencies"
  echo -e "  ${GREEN}revert${NC}   - Reverts a previous commit\n"
  echo -e "  ${RED}Commit aborted!${NC}\n"
  echo -e "${YELLOW}To bypass this check, use: git commit --no-verify${NC}"
  exit 1
fi

echo -e "${GREEN}‚úÖ Commit message format is valid!${NC}"
echo -e "${GREEN}Continuing with commit...${NC}\n"

exit 0
